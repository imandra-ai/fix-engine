(* Imandra Inc. copyright 2021 *)
[@@@program]
[@@@require "decoders-yojson"]
open Decoders_yojson.Basic.Decode;;
[@@@require "decoders-yojson"]
open Decoders_yojson.Basic.Decode.Infix;;
[@@@import "../src-types/model_messages.iml"]
open Model_messages;;
[@@@import "../src-string-factory/model_tag_names.iml"]
open Model_tag_names;;
[@@@import "../src-types/model_tags.iml"]
open Model_tags;;


let message_tag_decoder  : m_msg_tag decoder =
    string >>= (fun x -> (match tag_to_message x with
        | None -> (fail ("Unknown message tag ("^x^") in decoding"))
        | Some y -> (succeed y)
    )
    )
;;

let field_tag_decoder  : m_field_tag decoder =
    string >>= (fun x -> (match tag_to_field x with
        | None -> (fail ("Unknown field tag ("^x^") in decoding"))
        | Some y -> (succeed y)
    )
    )
;;

let field_missing_data_decoder  : field_missing_data decoder =
    (field "m_msg_tag" message_tag_decoder) >>= (fun msg -> (field "m_field_tag" field_tag_decoder) >>= (fun f -> succeed {
        field_missing_data_field = f;
        field_missing_data_msg = msg
    }
    )
    )
;;

[@@@logic]
