(* Imandra Inc. copyright 2021 *)
[@@@import "actions.iml"]
open Actions;;
[@@@import "model_messages.iml"]
open Model_messages;;


type state_event_info = {
    state_event_counter : int;
    state_event_reject_text : string option
}
;;

type outgoing_msg_record = {
    outgoing_msg_counter : int;
    outgoing_msg_msg : model_msg
}
;;

type model_state = {
    incoming_action : fix_action option;
    outgoing_msgs : outgoing_msg_record list;
    incoming_msg : model_top_level_msg;
    event_counter : int;
    event_info : state_event_info list
}
;;

let init_model_state = {
    incoming_action = None;
    outgoing_msgs = [];
    incoming_msg = FIX_TL_None;
    event_counter = 0;
    event_info = []
} [@@macro];;

let send_msg (msg : model_msg) (m_state : model_state)  =
    { m_state with
        outgoing_msgs = {
            outgoing_msg_counter = m_state.event_counter;
            outgoing_msg_msg = msg
        } :: m_state.outgoing_msgs
    }
    [@@macro]
;;

type internal_states_types = int list
;;

let get_internal_states_types (m_state : model_state)  : internal_states_types =
    []
    [@@macro]
;;

